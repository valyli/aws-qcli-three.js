# é›¶ä»£ç ç”Ÿæˆ 3D æ¸¸æˆï¼šåŸºäº Amazon Q Developer CLI å’Œ Three.js çš„å®è·µ

**Amazon Q Developer** æ˜¯ä¸€ä¸ªç”±ç”Ÿæˆå¼äººå·¥æ™ºèƒ½ï¼ˆAIï¼‰é©±åŠ¨çš„å¯¹è¯åŠ©æ‰‹ï¼Œå¯å¸®åŠ©ä½ ç†è§£ã€æ„å»ºã€æ‰©å±•å’Œè¿ç»´ AWS åº”ç”¨ç¨‹åºã€‚ä½ å¯ä»¥å‘å®ƒè¯¢é—®å…³äº AWS æ¶æ„ã€ä½ çš„ AWS èµ„æºã€æœ€ä½³å®è·µã€å®˜æ–¹æ–‡æ¡£ã€æŠ€æœ¯æ”¯æŒç­‰é—®é¢˜ã€‚Amazon Q ä¸æ–­æ›´æ–°å…¶èƒ½åŠ›ï¼Œç¡®ä¿ä¸ºä½ çš„é—®é¢˜æä¾›æœ€å…·ä¸Šä¸‹æ–‡ç›¸å…³æ€§å’Œå¯æ“ä½œæ€§çš„ç­”æ¡ˆã€‚

**Amazon Q Developer CLI** èƒ½æ•´åˆä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä½¿ Amazon Q æ›´æ·±å…¥ç†è§£ä½ çš„ä½¿ç”¨åœºæ™¯ï¼Œä»è€Œæä¾›ç›¸å…³ä¸”å…·æœ‰ä¸Šä¸‹æ–‡æ„ŸçŸ¥çš„å“åº”ã€‚å½“ä½ å¼€å§‹è¾“å…¥å‘½ä»¤æ—¶ï¼ŒAmazon Q ä¼šè‡ªåŠ¨è¡¥å…¨ç›¸å…³çš„å­å‘½ä»¤ã€é€‰é¡¹å’Œå‚æ•°ã€‚

**three.js** æ˜¯ä¸€ä¸ªæ„å»ºäº WebGL ä¹‹ä¸Šçš„è½»é‡çº§ 3D æ¸¸æˆå¼•æ“ã€‚å®ƒæ˜¯ä¸€ä¸ª JavaScript 3D åº“ï¼Œä½¿å¼€å‘è€…å¯ä»¥è½»æ¾åœ°åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ WebGL åˆ›å»ºå’Œå±•ç¤ºåŠ¨ç”» 3D å›¾å½¢ã€‚three.js å±è”½äº†åº•å±‚å›¾å½¢ API çš„å¤æ‚æ€§ï¼Œå…è®¸å¼€å‘è€…ç”¨ç®€æ´ã€é«˜å±‚æ¬¡çš„ä»£ç æ„å»ºæ²‰æµ¸å¼ã€äº¤äº’å¼çš„ 3D ä½“éªŒã€‚æ— è®ºä½ æ˜¯åœ¨åˆ›å»ºæ•°æ®å¯è§†åŒ–ã€ä»¿çœŸç³»ç»Ÿã€æ¸¸æˆï¼Œè¿˜æ˜¯äº§å“å±•ç¤ºï¼Œthree.js éƒ½èƒ½ä»¥é«˜æ€§èƒ½ã€çµæ´»æ€§å’Œæ˜“ç”¨æ€§ï¼Œå¸®åŠ©ä½ å°†åˆ›æ„å˜ä¸ºç°å®ã€‚


# å®¢æˆ·åœºæ™¯
æ¸¸æˆè¡Œä¸šçš„å®¢æˆ·ï¼Œåœ¨å‘è¡Œæ¸¸æˆäº§å“æ—¶ï¼Œéœ€è¦åˆ¶ä½œå¤§é‡çš„å¹¿å‘Šè§†é¢‘ç´ æç”¨äºæŠ•æ”¾ã€‚å› ä¸ºå¹¿å‘Šç´ æçš„ç”Ÿå‘½ä¸€èˆ¬éƒ½å¾ˆçŸ­ï¼Œåªæœ‰å‡ å¤©æ—¶é—´ã€‚å®¢æˆ·ä¸ºäº†ä¿è¯å¹¿å‘ŠæŠ•æ”¾æ•ˆæœç¨³å®šï¼Œå¿…é¡»æŒç»­åˆ¶ä½œå¤§é‡è§†é¢‘ç´ æï¼Œè¿›è¡ŒAB Testã€‚è¿™å ç”¨äº†ä»–ä»¬å¤§é‡çš„ç ”å‘å’Œç¾æœ¯äººåŠ›èµ„æºã€‚æ‰€ä»¥ï¼Œå®¢æˆ·ä¸ºäº†æå‡ç”Ÿäº§æ•ˆç‡ï¼Œé™ä½äººåŠ›æˆæœ¬ï¼Œå¸Œæœ›åˆ©ç”¨ç”Ÿæˆå¼äººå·¥æ™ºèƒ½æ¥å¸®åŠ©ä»–ä»¬ã€‚
åˆå› ä¸ºæ¸¸æˆè¡Œä¸šçš„ç‰¹æ€§ï¼Œè¿™äº›å¹¿å‘Šç´ æçš„å†…å®¹åŒºåˆ«äºå…¶ä»–è¡Œä¸šçš„ä¼ ç»Ÿå¹¿å‘Šã€‚å®ƒä»¬é€šå¸¸ä½¿ç”¨çš„æ˜¯è‡ªå·±æ¸¸æˆçš„ç¾æœ¯è®¾è®¡ï¼Œä¾‹å¦‚ï¼šè§’è‰²çš„3Dæ¨¡å‹ã€å¡é€šç•Œé¢ã€æŠ€èƒ½ç‰¹æ•ˆç­‰ã€‚å› ä¸ºå’ŒçœŸå®ä¸–ç•Œçš„åœºæ™¯å·®åˆ«å¾ˆå¤§ï¼Œè¿™ä½¿å¾—ç›®å‰ä¸»æµçš„ç”Ÿæˆå¼æ¨¡å‹æ— æ³•å¸®åŠ©ä»–ä»¬ç”Ÿæˆå¹¿å‘Šè§†é¢‘ã€‚å¹¶ä¸”åœ¨è§†é¢‘ä¸­ï¼Œå®¢æˆ·ç»å¸¸è¦æ±‚è§†é¢‘ä¸­çš„å¤šä¸ªæ¸¸æˆè§’è‰²ï¼ŒæŒ‰ç…§å‰§æœ¬è¿›è¡Œäº’åŠ¨ï¼Œæ¨è¿›å‰§æƒ…å‘å±•ã€‚è¿™ä¹Ÿè¶…å‡ºäº†ç›®å‰ä¸»æµçš„ç”Ÿæˆå¼æ¨¡å‹çš„èƒ½åŠ›èŒƒå›´ã€‚

# è§£å†³æ–¹æ¡ˆ
ä½¿ç”¨ Amazon Q Developer CLI çš„æ–¹å¼ï¼Œå¼•å…¥ Amazon Q å¼ºå¤§çš„äººå·¥æ™ºèƒ½èƒ½åŠ›ï¼Œç»“åˆ three.js 3Dæ¸¸æˆå¼•æ“ï¼Œç”Ÿæˆminiæ¸¸æˆã€‚å†é€šè¿‡è§†é¢‘å½•åˆ¶ï¼Œç”Ÿæˆè§†é¢‘å¹¿å‘Šç´ æã€‚å®¢æˆ·é€šè¿‡æ›¿æ¢è‡ªå·±æ¸¸æˆçš„ç¾æœ¯èµ„æºï¼Œå®ç°æ‰¹é‡ç”Ÿæˆè§†é¢‘ç´ æï¼Œæ»¡è¶³AB Testçš„æ•°é‡éœ€æ±‚ã€‚é€šè¿‡ Amazon Q Developer CLI çš„å¯¹è¯æ–¹å¼ï¼Œå¯ä»¥åœ¨ä¸å†™ä»£ç çš„æƒ…å†µä¸‹æ”¹ç¼–æ¼”å‡ºå‰§æœ¬ï¼Œä½¿å¹¿å‘Šåˆ›æ„äººå‘˜å¯ä»¥ç‹¬ç«‹å®ç°æ•ˆæœã€‚three.js çš„æ¸²æŸ“å¯è¿è¡Œäºäº‘ç«¯çš„ Headless æµè§ˆå™¨ç¯å¢ƒï¼ˆå¦‚ Puppeteer + Headless Chromeï¼‰ï¼Œå®ç°ç¦»çº¿å¼ã€è‡ªåŠ¨åŒ–çš„è§†é¢‘æ¸²æŸ“æµç¨‹ï¼Œé€‚åˆæ‰¹é‡ç”Ÿæˆå¹¿å‘Šç´ æï¼Œæ”¯æŒå¤šçº¿ç¨‹æ¸²æŸ“å’Œæ‰©å±•æ€§éƒ¨ç½²ã€‚åŒæ—¶å› ä¸º three.js æ˜¯å¼€æºé¡¹ç›®ï¼ŒAmazon Q å¯ä»¥ç†è§£å’Œå‚è€ƒ three.js çš„å…¨éƒ¨ä»£ç å’Œæ–‡æ¡£ï¼Œè·å¾—æ¯”å…¶ä»–å•†ç”¨é—­æºå¼•æ“æ›´å¥½çš„å‡†ç¡®æ€§ã€‚

# æ–¹æ¡ˆå®æ–½æ­¥éª¤
1. å®‰è£… Amazon Q for command line.
2. å…‹éš† three.js git ä»“åº“åˆ°æœ¬åœ°ç”µè„‘.
3. ä½¿ç”¨ Amazon Q Developer CLI ç†è§£ three.js å·¥ç¨‹çš„ä»£ç å’Œæ–‡æ¡£ã€‚
4. ä½¿ç”¨ Amazon Q Developer CLI ç¼–å†™ä¸€ä¸ªæ¸¸æˆåˆ›å»ºè®¡åˆ’ã€‚
5. ä½¿ç”¨ Amazon Q Developer CLI æ ¹æ®è®¡åˆ’åˆ›å»ºä¸€ä¸ªminiæ¸¸æˆå·¥ç¨‹ã€‚

# å®éªŒéªŒè¯
ä»¥ä¸‹å®éªŒè¿‡ç¨‹ä¸­ï¼Œäººå·¥æ²¡æœ‰ç¼–å†™ä»»ä½•ä¸€è¡Œä»£ç ã€‚ä¹Ÿæ²¡æœ‰æµè§ˆè¿‡ä»»ä½•å·¥ç¨‹ä»£ç ã€‚æœ¬åœ°ç¯å¢ƒä¸­ä¸éœ€è¦ä»»ä½•ç¼–ç¨‹IDEã€‚

ä»¥ä¸‹æ˜¯ä½¿ç”¨åˆ°çš„å…³é”®æç¤ºè¯ï¼š

1. ä½¿ç”¨ Amazon Q Developer CLI ç†è§£ three.js å·¥ç¨‹çš„ä»£ç å’Œæ–‡æ¡£ã€‚
    > è¿™ä¸ªè·¯å¾„ä¸‹,æ˜¯ä»three.js clone çš„gitåº“,å…¶ä¸­åŒ…å«å…¨éƒ¨çš„ä»£ç å’Œæ–‡æ¡£.æˆ‘æƒ³ç”¨ä¹‹ååˆ©ç”¨è¿™äº›ä¿¡æ¯,æŒ‡å¯¼ä½ æ¥åˆ¶ä½œä¸€æ¬¾åŸºäºthree.jsçš„æ¸¸æˆ.é‚£è¿™äº›èµ„æ–™åº”è¯¥å¦‚ä½•æ•´ç†?æˆ‘å¯ä»¥ä½¿ç”¨AWSä¸Šçš„æœåŠ¡,æ¯”å¦‚Bedrock,ä¹Ÿå¯ä»¥ä½¿ç”¨Knowledgebase.ç»™å‡ºæœ€åˆç†å’Œæœ€æ­£ç¡®çš„å»ºè®®.æˆ‘éœ€è¦ç¨³å®šå’Œå¯é çš„å·¥ä½œè´¨é‡.

2. æå‡ºåˆ›å»ºå°æ¸¸æˆçš„å…·ä½“è¦æ±‚ï¼Œå¹¶è¦æ±‚ Amazon Q Developer å…ˆåˆ¶å®šè®¡åˆ’ã€‚æ­¤æ­¥éª¤ç»“æŸæ—¶ï¼Œminiæ¸¸æˆå·¥ç¨‹å·²ç»åˆ›å»ºå®Œæˆï¼Œå¹¶å¯ä»¥åœ¨æµè§ˆå™¨ä¸­è¿è¡Œã€‚
   > åˆ›å»ºä¸€ä¸ªèµ›è½¦çš„å°æ¸¸æˆ,æ”¾åˆ°è¿™ä¸ªè·¯å¾„ /Users/valyli/three-js-demo . åˆ›å»ºä¹‹å‰,å…ˆåšè§„åˆ’,ç¡®å®šåˆ›å»ºçš„æ­¥éª¤.æŠŠè¿™ä¸ªè®¡åˆ’å†™å…¥ä¸€ä¸ªmarkdownæ–‡æ¡£.åç»­åˆ›å»ºè¿‡ç¨‹ä¸­,æ¯ä¸€ä¸ªæ­¥éª¤éƒ½é‡æ–°ä¸è¿™ä¸ªè®¡åˆ’æ–‡æ¡£è¿›è¡Œæ ¸å¯¹,å¹¶æ ‡æ³¨å®Œæˆçš„çŠ¶æ€.é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥ç¡®ä¿åˆ›å»ºè¿‡ç¨‹çš„è´¨é‡,ä¿è¯æœ€ç»ˆè¾“å‡ºçš„æ¸¸æˆå·¥ç¨‹å¯ä»¥æ­£ç¡®è¿è¡Œ.åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­,æœ€é‡è¦çš„æ˜¯åšå‡ºè¿™ä¸ªå°æ¸¸æˆ,èƒ½å¤Ÿæ­£å¸¸æ¼”ç¤º.å¹¶ä¸éœ€è¦å¤æ‚çš„ç©æ³•å’ŒåŠŸèƒ½.

3. ä¿®å¤BUGã€‚å¯ä»¥çœ‹åˆ°ï¼Œå¯¹äº3Dåœºæ™¯ï¼Œæ¨¡å‹åœ¨åæ ‡ç³»ä¸Šçš„å¤„ç†è¿˜ç¨æ˜¾é€Šè‰²ã€‚éœ€è¦è¾…åŠ©è¾“å…¥æ›´å¤šçš„è°ƒè¯•ä¿¡æ¯æ‰èƒ½ä¿®æ­£ã€‚
    > ç°åœ¨æ¸¸æˆå·²ç»èƒ½å¤Ÿè¿è¡Œ,è½¦å­ä¹Ÿå¯ä»¥æ§åˆ¶.ä½†æ˜¯æœ‰ä¸€äº›bug:
    1. è½¦å­çš„å·¦å³æ–¹å‘æ§åˆ¶åäº†
    2. è½¦å­çš„æ–¹å‘æ§åˆ¶,å‚ç…§ç³»å¥½åƒä¸æ˜¯è½¦å­æœ¬èº«

    > æ–°çš„é—®é¢˜,é•œå¤´è·‘åˆ°è½¦çš„ä¸‹é¢äº†.åº”è¯¥æ˜¯åœ¨è½¦çš„ä¸Šæ–¹,è·Ÿéšåœ¨æ–œåæ–¹çš„ä½ç½®

    > å‰è¿›å’Œåé€€çš„å‚ç…§ç³»,éœ€è¦ä»¥è½¦ä½“çš„åæ ‡ç³»ä¸ºå‡†

    > Wå’ŒSé”®,æ§åˆ¶æ–¹å‘çš„é€»è¾‘ä¸å¯¹.å½“è½¦ä½“å‘ç”Ÿæ–¹å‘æ—‹è½¬å,Wå’ŒSçš„æ“ä½œç»“æœå°±æ··ä¹±äº†.é‡æ–°æ£€æŸ¥è¿™2ä¸ªæŒ‰é”®çš„æ§åˆ¶é€»è¾‘.ä¸€å®šè¦æ ¹æ®è½¦å¤´å½“å‰çš„æ–¹å‘æ¥åˆ¤æ–­.

    > Wäº§ç”Ÿçš„æ¨åŠ›,å¿…é¡»æ²¿è½¦å¤´æ–¹å‘å‘å‰;Säº§ç”Ÿçš„æ¨åŠ›,å¿…é¡»æ²¿è½¦å°¾æ–¹å‘å‘å.ä½ ç°åœ¨æä¾›çš„ç¨‹åº,æ²¡æœ‰å®ç°è¿™ä¸ªæ•ˆæœ.è¿™éƒ¨åˆ†ä»£ç é‡æ–°ç”Ÿæˆ

    > è¿˜æ˜¯ä¸€æ¨¡ä¸€æ ·çš„é—®é¢˜,æ²¡æœ‰ä¿®å¤.å‘ç°ä¸€ä¸ªç°è±¡,å½“è½¦ä»åˆå§‹ä½ç½®å‡ºå‘,è½¬å‘è¶…è¿‡180åº¦å,Wå’ŒSé”®ä½œç”¨å¯¹è°ƒäº†

    > è¿™æ¬¡ä¿®æ”¹å,Wå’ŒSé”®å·²ç»æ— æ•ˆäº†

    > è¿˜æ˜¯ä¸åŠ¨

4. æ·»åŠ ç‰©ç†ç¢°æ’ã€‚ç»“æŸæ•´ä¸ªç”Ÿæˆè¿‡ç¨‹ã€‚
    > ç°åœ¨æŒ‰é”®æ§åˆ¶å·²ç»æ­£ç¡®.æˆ‘è¿˜æ˜¯å¸Œæœ›èƒ½æœ‰ç‰©ç†æ¨¡å‹,ä»¥åŠç¢°æ’çš„åŠŸèƒ½.è¯·æ·»åŠ 


# ç”Ÿæˆæ•ˆæœå±•ç¤º
![alt text](./doc_assets/image.png)
![alt text](./doc_assets/demo.gif)


# ç”Ÿæˆè¿‡ç¨‹è®°å½•
[record](./amazon-q-cli-record.md)


# ç”Ÿæˆçš„demoå·¥ç¨‹
[project code](./three-js-demo/)

# æœ¬åœ°æ¸²æŸ“åŸå‹è®¾è®¡ï¼ˆéªŒè¯æ€è·¯ï¼‰
åœ¨æœ¬é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬ä¸ä»…å®ç°äº†åŸºäºThree.jsçš„3Dæ¸¸æˆï¼Œè¿˜æä¾›äº†ä¸€ä¸ªå¼ºå¤§çš„åŠŸèƒ½ï¼šå°†æ¸¸æˆç”»é¢æ¸²æŸ“ä¸ºè§†é¢‘æ–‡ä»¶ã€‚è¿™ä¸ªåŠŸèƒ½å¯¹äºç”Ÿæˆå¹¿å‘Šç´ æç‰¹åˆ«æœ‰ç”¨ï¼Œè®©åˆ›æ„äººå‘˜å¯ä»¥è½»æ¾å½•åˆ¶æ¸¸æˆåœºæ™¯ï¼Œç”¨äºè¥é”€æ¨å¹¿ã€‚ä¸‹é¢æˆ‘ä»¬æ¥è¯¦ç»†è§£æè¿™ä¸ªåŠŸèƒ½çš„å®ç°åŸç†å’Œä½¿ç”¨æ–¹æ³•ã€‚

## æ¸²æŸ“æœåŠ¡å™¨ä¸å®¢æˆ·ç«¯ä»£ç åˆ†æ

### æ¸²æŸ“æœåŠ¡å™¨ (render_server)
æ¸²æŸ“æœåŠ¡å™¨ä¸»è¦ç”±ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ç»„æˆï¼š

1. **server.js**ï¼šæ ¸å¿ƒæœåŠ¡å™¨ä»£ç 
   - ä½¿ç”¨Expressåˆ›å»ºWebæœåŠ¡å™¨ï¼Œæä¾›é™æ€æ–‡ä»¶æœåŠ¡
   - ä½¿ç”¨Socket.IOå»ºç«‹ä¸å®¢æˆ·ç«¯çš„å®æ—¶é€šä¿¡
   - æ¥æ”¶å®¢æˆ·ç«¯å‘é€çš„æ¯ä¸€å¸§ç”»é¢ï¼Œå¹¶å†™å…¥FIFOç®¡é“
   - ä¸FFmpegååŒå·¥ä½œï¼Œå°†å¸§åºåˆ—è½¬æ¢ä¸ºè§†é¢‘æ–‡ä»¶

2. **render.sh**ï¼šæ¸²æŸ“è„šæœ¬
   - æ¥æ”¶å‚æ•°ï¼šè§†é¢‘å°ºå¯¸ã€è¾“å‡ºæ–‡ä»¶åã€å¸§ç‡
   - åˆ›å»ºFIFOç®¡é“ç”¨äºæ•°æ®ä¼ è¾“
   - å¯åŠ¨Node.jsæœåŠ¡å™¨å¹¶å°†å…¶è¾“å‡ºé€šè¿‡ç®¡é“ä¼ ç»™FFmpeg
   - FFmpegè´Ÿè´£å°†åŸå§‹å¸§æ•°æ®ç¼–ç ä¸ºè§†é¢‘æ–‡ä»¶

### å®¢æˆ·ç«¯ä»£ç  (three-js-demo)
å®¢æˆ·ç«¯ä»£ç ä¸»è¦åœ¨`main.js`æ–‡ä»¶ä¸­å®ç°äº†ä¸æ¸²æŸ“æœåŠ¡å™¨çš„é€šä¿¡ï¼š

1. **Socket.IOè¿æ¥**ï¼š
   - æ£€æµ‹URLå‚æ•°ä¸­æ˜¯å¦åŒ…å«`size`å‚æ•°ï¼Œä»¥ç¡®å®šæ˜¯å¦å¤„äºæ¸²æŸ“æ¨¡å¼
   - å»ºç«‹ä¸æ¸²æŸ“æœåŠ¡å™¨çš„Socket.IOè¿æ¥

2. **å¸§æ•è·é€»è¾‘**ï¼š
   - åœ¨æ¸¸æˆå¾ªç¯ä¸­æ•è·æ¯ä¸€å¸§çš„æ¸²æŸ“ç»“æœ
   - å°†æ¸²æŸ“ç»“æœè½¬æ¢ä¸ºPNGæ ¼å¼çš„æ•°æ®URL
   - é€šè¿‡Socket.IOå‘é€ç»™æœåŠ¡å™¨

## å®ç°åŸç†

æ•´ä¸ªè§†é¢‘æ¸²æŸ“è¿‡ç¨‹çš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š

1. ç”¨æˆ·æ‰§è¡Œ`render.sh`è„šæœ¬ï¼ŒæŒ‡å®šè§†é¢‘å‚æ•°
2. è„šæœ¬åˆ›å»ºFIFOç®¡é“ï¼Œå¯åŠ¨Node.jsæœåŠ¡å™¨
3. æœåŠ¡å™¨å¯åŠ¨Chromeæµè§ˆå™¨ï¼ŒåŠ è½½æ¸¸æˆé¡µé¢
4. æ¸¸æˆé¡µé¢æ£€æµ‹åˆ°æ¸²æŸ“æ¨¡å¼ï¼Œè¿æ¥åˆ°Socket.IOæœåŠ¡å™¨
5. æœåŠ¡å™¨è¯·æ±‚ç¬¬ä¸€å¸§ï¼Œå®¢æˆ·ç«¯æ¸²æŸ“å¹¶å‘é€
6. æœåŠ¡å™¨æ¥æ”¶å¸§æ•°æ®ï¼Œè½¬æ¢åå†™å…¥FIFOç®¡é“
7. FFmpegä»ç®¡é“è¯»å–æ•°æ®ï¼Œç¼–ç ä¸ºè§†é¢‘æ–‡ä»¶
8. é‡å¤æ­¥éª¤5-7ç›´åˆ°æ¸¸æˆç»“æŸæˆ–ç”¨æˆ·ä¸­æ–­

## å¦‚ä½•åœ¨Three.jsé¡¹ç›®ä¸­æ·»åŠ è§†é¢‘æ¸²æŸ“åŠŸèƒ½

è¦åœ¨è‡ªå·±çš„Three.jsé¡¹ç›®ä¸­æ·»åŠ ç±»ä¼¼çš„è§†é¢‘æ¸²æŸ“åŠŸèƒ½ï¼Œå¯ä»¥æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

1. **å‡†å¤‡æ¸²æŸ“æœåŠ¡å™¨**ï¼š
   - å¤åˆ¶`render_server`ç›®å½•åˆ°ä½ çš„é¡¹ç›®ä¸­
   - å®‰è£…å¿…è¦çš„ä¾èµ–ï¼š`npm install express socket.io get-pixels`

2. **ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç **ï¼š
   - åœ¨æ¸¸æˆçš„ä¸»JavaScriptæ–‡ä»¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ï¼š

   ```javascript
   // å…¨å±€å˜é‡ï¼Œç”¨äºå­˜å‚¨socketè¿æ¥
   let socket;

   // åœ¨åˆå§‹åŒ–å‡½æ•°ä¸­æ·»åŠ 
   function init() {
     // åŸæœ‰çš„åˆå§‹åŒ–ä»£ç ...
     
     // æ£€æŸ¥æ˜¯å¦å¤„äºæ¸²æŸ“æ¨¡å¼
     if (location.search.includes('?size=')) {
       initRenderMode();
     }
   }

   // æ¸²æŸ“æ¨¡å¼åˆå§‹åŒ–
   function initRenderMode() {
     // è§£æå°ºå¯¸å‚æ•°
     const sizeParam = location.search.split('?size=')[1];
     const [width, height] = sizeParam.split('x').map(Number);
     
     // è°ƒæ•´æ¸²æŸ“å™¨å°ºå¯¸
     renderer.setSize(width, height);
     
     // è¿æ¥åˆ°Socket.IOæœåŠ¡å™¨
     socket = io();
     
     // å‘é€é—®å€™
     socket.emit('greetings', {});
     
     // ç›‘å¬æœåŠ¡å™¨è¯·æ±‚
     socket.on('nextFrame', function(ready) {
       // æ¸²æŸ“ä¸€å¸§å¹¶å‘é€
       renderer.render(scene, camera);
       const dataURL = renderer.domElement.toDataURL('image/png');
       socket.emit('newFrame', { png: dataURL });
     });
   }

   // åœ¨æ¸¸æˆå¾ªç¯ä¸­æ·»åŠ ï¼ˆå¯é€‰ï¼Œç”¨äºæŒç»­å‘é€å¸§ï¼‰
   function gameLoop() {
     // åŸæœ‰çš„æ¸¸æˆå¾ªç¯ä»£ç ...
     
     // æ¸²æŸ“åœºæ™¯
     renderer.render(scene, camera);
     
     // å¦‚æœåœ¨æ¸²æŸ“æ¨¡å¼ä¸‹ï¼Œå‘é€å½“å‰å¸§
     if (socket && socket.connected) {
       const dataURL = renderer.domElement.toDataURL('image/png');
       socket.emit('newFrame', { png: dataURL });
     }
   }
   ```

3. **ä½¿ç”¨æ–¹æ³•**ï¼š
   - ç¡®ä¿FFmpegå·²å®‰è£…åœ¨ç³»ç»Ÿä¸­
   - æ‰§è¡Œæ¸²æŸ“è„šæœ¬ï¼š`./render.sh -s 640x480 -o output.mp4 -f 24`
   - å‚æ•°è¯´æ˜ï¼š
     - `-s`: è§†é¢‘å°ºå¯¸ï¼ˆå®½xé«˜ï¼‰
     - `-o`: è¾“å‡ºæ–‡ä»¶å
     - `-f`: å¸§ç‡

é€šè¿‡è¿™ç§æ–¹å¼ï¼Œä½ å¯ä»¥è½»æ¾åœ°å°†ä»»ä½•Three.jsé¡¹ç›®è½¬æ¢ä¸ºè§†é¢‘ç”Ÿæˆå·¥å…·ï¼Œä¸ºå¹¿å‘Šåˆ›æ„æä¾›æ›´å¤šå¯èƒ½æ€§ã€‚


# äº‘ç«¯æ¸²æŸ“éƒ¨ç½²æ–¹æ¡ˆ

ä¸ºæ»¡è¶³äº‘ä¸Šè‡ªåŠ¨åŒ–ç”Ÿäº§éœ€æ±‚ï¼Œæˆ‘ä»¬å¯å°†æ¸²æŸ“æµç¨‹éƒ¨ç½²åœ¨ AWS äº‘ç«¯ä¸»æœºä¸Šï¼š

- ä½¿ç”¨ **EC2** æˆ– **Fargate å®¹å™¨** å¯åŠ¨ Node.js + Puppeteer æœåŠ¡  
- äº‘ç«¯ **Headless Chrome** åŠ è½½ three.js é¡µé¢ï¼Œè‡ªåŠ¨è¿è¡ŒæŒ‡å®šå‰§æœ¬  
- ä½¿ç”¨ **FFmpeg** å½•åˆ¶å¸§åºåˆ—ä¸ºé«˜è´¨é‡è§†é¢‘  
- æœ€ç»ˆè¾“å‡ºä¸Šä¼ è‡³ **Amazon S3**ï¼Œä¾›åç»­ä½¿ç”¨  

è¯¥æ–¹æ¡ˆå…·å¤‡ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- **å¯æ¨ªå‘æ‰©å±•**ï¼Œé€‚é… AB Test æ‰¹é‡ç´ æç”Ÿæˆ  
- **å¯è¿½è¸ªã€å¤ç°æ¸²æŸ“è¿‡ç¨‹**ï¼ˆå®¹å™¨ ID + å‰§æœ¬è¾“å…¥ + Git å“ˆå¸Œï¼‰  
- å¯ä¸ **Step Functions / EventBridge** ç¼–æ’æµç¨‹ï¼Œæˆ–ç»“åˆ **Bedrock** è‡ªåŠ¨ç”Ÿæˆå‰§æœ¬ä¸æ–‡æ¡ˆ 

## Node.js + Puppeteer + FFmpeg ç¤ºä¾‹ä»£ç 

```js
// render.js - Node.js è„šæœ¬ï¼Œç”¨äºäº‘ç«¯è‡ªåŠ¨æ¸²æŸ“å¹¶å½•åˆ¶

const puppeteer = require('puppeteer');
const { spawn } = require('child_process');
const fs = require('fs');

(async () => {
  const browser = await puppeteer.launch({
    headless: true,
    args: ['--no-sandbox', '--disable-gpu'],
  });

  const page = await browser.newPage();
  const width = 1280, height = 720;
  await page.setViewport({ width, height });

  // è½½å…¥ three.js æ¸¸æˆé¡µé¢
  await page.goto('https://your-s3-site-url/game.html?record=true');

  // å¯åŠ¨ FFmpeg è¿›ç¨‹ï¼Œå½•åˆ¶å±å¹•å¸§
  const ffmpeg = spawn('ffmpeg', [
    '-y',
    '-f', 'image2pipe',
    '-r', '24',
    '-i', '-',             // ä» stdin æ¥æ”¶å›¾åƒå¸§
    '-c:v', 'libx264',
    '-pix_fmt', 'yuv420p',
    'output.mp4'
  ]);

  // æŒç»­æŠ“å–é¡µé¢å¸§å¹¶ä¼ å…¥ FFmpeg
  for (let i = 0; i < 240; i++) {  // å½•åˆ¶ 10 ç§’ï¼ˆ24fpsï¼‰
    const screenshot = await page.screenshot({ type: 'png' });
    ffmpeg.stdin.write(screenshot);
  }

  ffmpeg.stdin.end();
  await browser.close();
})();
```

## ä½¿ç”¨è¯´æ˜

- å°† `render.js` è„šæœ¬éƒ¨ç½²åœ¨ **EC2** æˆ– **Fargate** å®¹å™¨ä¸­è¿è¡Œ  
- å°† `game.html` æ‰˜ç®¡åœ¨ **Amazon S3** å¹¶å¯ç”¨é™æ€ç½‘ç«™æ‰˜ç®¡åŠŸèƒ½  
- æ¸²æŸ“å®Œæˆåç”Ÿæˆçš„ `output.mp4` å¯é€šè¿‡ AWS CLI ä¸Šä¼ è‡³ S3ï¼š

```bash
aws s3 cp output.mp4 s3://your-bucket/ads/output.mp4
```

# å¯¹ç…§ç»„æµ‹è¯•
åœ¨å¯¹ç…§ç»„æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬å‘ Amazon Q Developer CLI æå‡ºåŒæ ·çš„è¦æ±‚ï¼Œä½†ä¸å†æä¾› three.js çš„ä»£ç å’Œæ–‡æ¡£ã€‚è§‚å¯Ÿå®ƒçš„ç”Ÿæˆè¿‡ç¨‹ã€‚

1. ç§»é™¤ç†è§£ three.js å·¥ç¨‹å’Œæ–‡æ¡£çš„éƒ¨åˆ†ã€‚ç„¶åè¾“å…¥ä¸€æ ·çš„æå‡è¯ï¼Œè¦æ±‚ç”Ÿæˆä¸€ä¸ªå°æ¸¸æˆã€‚
    > åˆ›å»ºä¸€ä¸ªèµ›è½¦çš„å°æ¸¸æˆ,æ”¾åˆ°è¿™ä¸ªè·¯å¾„ /Users/valyli/three-js-demo-2 . åˆ›å»ºä¹‹å‰,å…ˆåšè§„åˆ’,ç¡®å®šåˆ›å»ºçš„æ­¥éª¤.æŠŠè¿™ä¸ªè®¡åˆ’å†™å…¥ä¸€ä¸ªmarkdownæ–‡æ¡£.åç»­åˆ›å»ºè¿‡ç¨‹ä¸­,æ¯ä¸€ä¸ªæ­¥éª¤éƒ½é‡æ–°ä¸è¿™ä¸ªè®¡åˆ’æ–‡æ¡£è¿›è¡Œæ ¸å¯¹,å¹¶æ ‡æ³¨å®Œæˆçš„çŠ¶æ€.é€šè¿‡è¿™ä¸ªæ–¹æ³•æ¥ç¡®ä¿åˆ›å»ºè¿‡ç¨‹çš„è´¨é‡,ä¿è¯æœ€ç»ˆè¾“å‡ºçš„æ¸¸æˆå·¥ç¨‹å¯ä»¥æ­£ç¡®è¿è¡Œ.åœ¨è¿™ä¸ªç‰ˆæœ¬ä¸­,æœ€é‡è¦çš„æ˜¯åšå‡ºè¿™ä¸ªå°æ¸¸æˆ,èƒ½å¤Ÿæ­£å¸¸æ¼”ç¤º.å¹¶ä¸éœ€è¦å¤æ‚çš„ç©æ³•å’ŒåŠŸèƒ½.

2. è§‚å¯Ÿç”Ÿæˆè¿‡ç¨‹ï¼Œå‘è¡Œè¿™æ¬¡ Amazon Q Developer CLI æ‰§è¡Œäº† three.js çš„å®‰è£…æ­¥éª¤ã€‚


    ```bash
    ğŸ› ï¸  Using tool: execute_bash (trusted)
    â‹® 
    â— I will run the following shell command: 
    cd /Users/valyli/three-js-demo-2 && npm install three@0.159.0 serve@14.2.1
    â‹® 
    â†³ Purpose: å®‰è£…é¡¹ç›®ä¾èµ–


    added 91 packages, and audited 92 packages in 7s

    24 packages are looking for funding
    run `npm fund` for details

    3 high severity vulnerabilities

    To address all issues, run:
    npm audit fix --force

    Run `npm audit` for details.
    ```

3. æˆ‘ä»¬åˆ©ç”¨å…¶ä¸­çš„å…³é”®æ­¥éª¤ï¼Œthree.js çš„åº“å¼•ç”¨æ–¹å¼è¿›è¡Œåˆ†æã€‚
   1. å¯¹ç…§ç»„
    ```bash
    npm install three@0.159.0 serve@14.2.1
    ```
    è¿™ä¸ªå®‰è£…å‘½ä»¤åœ¨ three.js å®˜æ–¹æ–‡æ¡£æ— æ³•æ‰¾åˆ°ã€‚æ‰€ä»¥æ˜¯ Amazon Q Developer CLI æ ¹æ®æ¨¡å‹å·²æœ‰çš„çŸ¥è¯†ç”Ÿæˆã€‚
   
    2. demo
   ```html
    <!-- å¼•å…¥ Three.js åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.160.0/build/three.min.js"></script>
   ```
   è¿™ä¸ªå¼•ç”¨æ–¹å¼ï¼Œå¯ä»¥åœ¨å®˜æ–¹æ–‡æ¡£ä¸­æ‰¾åˆ°ã€‚è¯´æ˜ Amazon Q Developer CLI åœ¨æŒ‰ç…§è¦æ±‚ç†è§£æ–‡æ¡£åæ‰§è¡Œçš„ç”Ÿæˆã€‚
   ç›¸å…³æ–‡æ¡£ï¼šhttps://threejs.org/manual/#en/installation

æ‰€ä»¥ï¼Œé€šè¿‡è¦æ±‚ Amazon Q Developer CLI ç†è§£æŒ‡å®šæ–‡æ¡£å’Œä»£ç çš„æ–¹å¼ï¼Œèƒ½å¤Ÿæ›´å‡†ç¡®çš„æŒ‰ç…§æˆ‘ä»¬çš„æ„æ„¿ç”Ÿæˆå†…å®¹ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹å¼ï¼Œä¸ºæ¨¡å‹è¾“å…¥æ›´é«˜è´¨é‡çš„ä¿¡æ¯ï¼Œä»¥åŠæˆ‘ä»¬éœ€æ±‚ä¸­ç‰¹æœ‰çš„ä¿¡æ¯ã€‚

# é™„å½•

1. Amazon Q for command line å®‰è£…è¯´æ˜

https://docs.aws.amazon.com/amazonq/latest/qdeveloper-ug/command-line-installing.html

2. three.js github åœ°å€

https://github.com/mrdoob/three.js
